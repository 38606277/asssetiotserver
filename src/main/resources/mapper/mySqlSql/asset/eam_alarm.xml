<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="eam_alarm">


	<select id="addEamAlarm" parameterType="Map">
		INSERT INTO asset_alarm (alarm_num, asset_id, alarm_type) VALUES (#{alarm_num},#{asset_id},#{alarm_type})
	</select>


	<select id="countEamAlarmByPage" resultType="int" parameterType="Map">
		SELECT
		count(1)
		FROM
		asset_alarm a
		LEFT JOIN  eam_asset e on a.asset_id = e.asset_id
		where 1=1
		<if test="keyword != null and keyword!=''">
			and (a.alarm_num like '%${keyword}%' or a.alarm_type like '%${keyword}%' or a.status like '%${keyword}%' or e.asset_num like '%${keyword}%' or e.iot_num like '%${keyword}%' or e.asset_name like '%${keyword}%')
		</if>
		limit #{startIndex},#{perPage}
	</select>

	<select id="listEamAlarmByPage" resultType="Map" parameterType="Map">
		SELECT
		a.alarm_id ,
		a.alarm_num ,
		a.asset_id ,
		a.alarm_type ,
		DATE_FORMAT(alarm_time,'%Y-%m-%d %H:%i:%s') as alarm_time,
		a.status ,
		a.Handler,
		a.remark,
		e.asset_num,
		e.asset_name,
		e.iot_num,
		e.create_time,
		e.user,
		e.responsible
		FROM
		asset_alarm a
		LEFT JOIN  eam_asset e on a.asset_id = e.asset_id
		where 1=1
		<if test="keyword != null and keyword!=''">
			and (a.alarm_num like '%${keyword}%' or a.alarm_type like '%${keyword}%' or a.status like '%${keyword}%' or e.asset_num like '%${keyword}%' or e.iot_num like '%${keyword}%' or e.asset_name like '%${keyword}%')
		</if>
		limit #{startIndex},#{perPage}
	</select>

	<update id="updateAlarmStatus" parameterType="Map">
		update asset_alarm set status=#{status},remark=#{remark} where alarm_id=#{alarm_id}
	</update>
</mapper>
